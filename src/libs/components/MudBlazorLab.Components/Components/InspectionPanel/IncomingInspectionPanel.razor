@using MudBlazor
@using MudBlazorLab.Components.Models
@using MudBlazorLab.Components.Services
@using MudBlazorLab.Components.Components

<MudStack Spacing="2">
  <MudCard>
    <MudCardHeader>
      <MudText Typo="Typo.h6">表单列表</MudText>
    </MudCardHeader>
    <MudCardContent>
      <MudDataGrid T="DocHeader" Items="@DocHeaders" Bordered="true" Dense="true" Hover="true" Filterable="true"
        RowClick="OnDocRowClick">
        <Columns>
          <PropertyColumn Property="x => x.Template" Title="表单模板" />
          <PropertyColumn Property="x => x.DocNo" Title="表单单号" />
          <PropertyColumn Property="x => x.ErpNo" Title="ERP单号" />
          <TemplateColumn T="DocHeader" Title="状态">
            <CellTemplate Context="ctx">
              <MudChip
                Color="@(ctx.Item.StatusText == "开始" ? Color.Success : ctx.Item.StatusText == "结束" ? Color.Error : Color.Default)"
                Variant="Variant.Filled">@ctx.Item.StatusText</MudChip>
            </CellTemplate>
          </TemplateColumn>
          <PropertyColumn Property="x => x.CreatedAt" Title="创建日期" />
          <PropertyColumn Property="x => x.Creator" Title="创建人" />
          <TemplateColumn T="DocHeader" Title="操作">
            <CellTemplate Context="ctx">
              <MudStack Row="true" Spacing="1" AlignItems="AlignItems.Center">
                <MudButton Variant="Variant.Text" Color="Color.Success" Disabled="@(ctx.Item.StatusText != "创建")"
                  OnClick="@(() => StartDocFor(ctx.Item))" StartIcon="@Icons.Material.Filled.PlayArrow">开始</MudButton>
                <MudButton Variant="Variant.Text" Color="Color.Error" Disabled="@(ctx.Item.StatusText != "开始")"
                  OnClick="@(() => EndDocFor(ctx.Item))" StartIcon="@Icons.Material.Filled.Stop">结束</MudButton>
                <MudButton Variant="Variant.Text" Color="Color.Primary" Disabled="@(ctx.Item.StatusText != "开始")"
                  OnClick="@(() => AddObjectRowFor(ctx.Item))" StartIcon="@Icons.Material.Filled.Add">新增对象明细</MudButton>
              </MudStack>
            </CellTemplate>
          </TemplateColumn>
        </Columns>
        <ToolBarContent>
          <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="2">
            <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="@OpenAddDocDialog"
              StartIcon="@Icons.Material.Filled.Add">新增表单</MudButton>
          </MudStack>
        </ToolBarContent>
      </MudDataGrid>
    </MudCardContent>
  </MudCard>

  <MudCard>
    <MudCardHeader>
      <MudText Typo="Typo.h6">对象明细</MudText>
    </MudCardHeader>
    <MudCardContent>
      <MudDataGrid T="ObjectRow" Items="@ObjectRows" Bordered="true" Dense="true" Hover="true" Filterable="true"
        RowClick="OnObjectRowClick">
        <Columns>
          <PropertyColumn Property="x => x.ObjectType" Title="对象类型" />
          <PropertyColumn Property="x => x.ObjectName" Title="对象名称" />
          <PropertyColumn Property="x => x.Batch" Title="批次" />
          <PropertyColumn Property="x => x.Total" Title="总量" />
          <PropertyColumn Property="x => x.SampleRateText" Title="抽样率" />
          <PropertyColumn Property="x => x.Result" Title="校验结果" />
          <PropertyColumn Property="x => x.CreatedAt" Title="创建日期" />
          <PropertyColumn Property="x => x.Creator" Title="创建人" />
          <TemplateColumn T="ObjectRow" Title="操作">
            <CellTemplate Context="ctx">
              <MudButton Variant="Variant.Text" Color="Color.Primary"
                Disabled="@((SelectedDoc?.StatusText ?? string.Empty) != "开始")"
                OnClick="@(() => AddSampleFor(ctx.Item))" StartIcon="@Icons.Material.Filled.Add">新增样本</MudButton>
            </CellTemplate>
          </TemplateColumn>
        </Columns>

      </MudDataGrid>
    </MudCardContent>
  </MudCard>

  <MudCard>
    <MudCardHeader>
      <MudText Typo="Typo.h6">样本检查</MudText>
    </MudCardHeader>
    <MudCardContent>
      <MudDataGrid T="SnRow" Items="@SnRows" Bordered="true" Dense="true" Hover="true" Filterable="true">
        <Columns>
          <PropertyColumn Property="x => x.Sn" Title="SN" />
          <PropertyColumn Property="x => x.Item" Title="检查项" />
          <PropertyColumn Property="x => x.Unit" Title="单位" />
          <TemplateColumn T="SnRow" Title="数值">
            <CellTemplate Context="ctx">
              <MudText>@ctx.Item.Value</MudText>
            </CellTemplate>
          </TemplateColumn>
          <PropertyColumn Property="x => x.Result" Title="校验结果" />
        </Columns>

      </MudDataGrid>
    </MudCardContent>
  </MudCard>
</MudStack>