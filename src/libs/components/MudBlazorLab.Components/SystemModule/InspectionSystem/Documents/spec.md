**目标与范围**
- 支持设备/开班点检的表单、对象明细、详情项的完整录入流程。
- 强化配置与数据的边界：配置只读，业务数据读写分离。
- 增强可用性：分页、筛选、布局比例与必填校验。

**数据分层**
- 配置数据：模板摘要（含检验级别）、模板项、模板描述、模板单位、产线、工单，只读访问。
- 业务数据：表单（Doc）、对象明细（Object）、详情项（Detail），提供查询与新增、状态更新。
- DTO 与表结构解耦，接口层使用 DTO，内部映射为实体。

**交互流程**
- 新增表单：用户选择模板、产线、工单，输入单号与创建人，仅日期默认当前。
- 流程状态：表单初始“创建”，可切换“开始”“结束”；对象与详情新增仅在“开始”时允许。
- 新增对象明细：输入对象类型、名称、批次、总量、创建人
- 新增详情项：按当前模板加载候选（对象、项、描述、单位），录入多行并提交。

**输入与校验**
- 所有输入项均为必填项。
- “结果”字段使用受限下拉（OK/NG）。
- 其他下拉均支持录入列表中不存在的项并保留，不强制必须来自候选。

**候选项与自由输入**
- 候选项来源：
  - 模板项：用于详情“检查项”候选。
  - 模板描述：用于详情“检查描述”候选。
  - 模板单位：与模板项单位合并去重，用于“单位”候选。
- 单位联动：选择“检查项”时可带出偏好单位（来自模板），但允许用户覆盖。

**状态管理**
- 状态枚举为“创建/开始/结束”，支持前端筛选。
- 状态变更触发列表刷新与按钮使能变化（仅“开始”时允许新增对象与详情）。

**分页与布局**
- 三块区域使用固定表头与分页，布局高度比例约 1:1:2。
- 行间距收紧以提升密度；分页尺寸为小表（10/20/50）与大表（15/30/60）。

**配置与开关**
- 新建后自动开始开关：可选在新建表单后自动置“开始”并弹出“新增对象明细”，默认关闭。

**计算规则**
- 详情项提交后按存在 NG 决定对象明细的结果为 NG 或 OK。


**控件选择**
- 表单与对话框输入
  - `MudAutocomplete`：模板、产线、工单、创建人、详情对象/检查项/描述/单位
  - `MudTextField`：对象类型、对象名称、批次、表单单号
  - `MudNumericField`：对象总量、详情数值
  - `MudDatePicker`：创建日期
  - `MudSelect`：结果（OK/NG 受限下拉）
- 列表与布局
  - `MudDataGrid`：表单列表、对象明细列表、详情项列表
  - `MudChip`：状态展示（创建/开始/结束）
  - `MudStack`：整体布局与工具栏区域
  - `MudDataGridPager`：分页器
- 弹窗
  - 通过对话框服务打开新增表单/对象/详情的对话框

**属性配置**
- 可输入不存在项且保留
  - `MudAutocomplete` 统一设置：`CoerceText=true`、`CoerceValue=true`、`Clearable=true`、`Dense=true`
  - 关闭严格模式（不要启用 `Strict`），避免强制必须选择候选项
  - 推荐 `ResetValueOnEmptyText=false`（如需要保留用户文本时不自动清空）
- 必填与按钮禁用
  - 输入控件设置 `Required=true`
  - 对话框“确定”按钮：`Disabled=!CanSubmit...`（绑定综合校验布尔值）
- 结果字段受限
  - `MudSelect` 固定选项：`OK`、`NG`；同时 `Required=true`
- 日期与默认值
  - 日期默认当前；其余输入项默认空字符串或 0
- 列表与分页
  - `MudDataGrid`：`Filterable=true`、`Dense=true`、`Hover=true`、`FixedHeader=true`
  - 高度比例：上两块约 `25vh`、下方详情 `50vh`
  - 分页：`RowsPerPage` 配合 `MudDataGridPager PageSizeOptions={10,20,50}`
  - 使用过滤器结合自定义筛选集合（“创建/开始/结束”），在工具栏或筛选区域以 `Chip` 交互进行筛选
- 单位联动
  - 选择“检查项”后，若单位为空则带出模板项的偏好单位；但仍允许用户覆盖

**交互与流程**
- 新增表单
  - 用户选择模板/产线/工单并填单号与创建人，仅日期默认当前
  - 提交成功后刷新列表；可选开关启用“自动开始并弹出新增对象明细”
- 状态管理
  - 表单初始为“创建”；切换到“开始”后允许新增对象与详情；结束后禁用新增操作
- 新增对象明细
  - 输入对象信息与总量，系统基于模板检验级别计算抽样数量与抽样率并展示
- 新增详情项
  - 候选项从配置获取；所有非“结果”类下拉支持自由输入并保留
  - 提交后按是否存在 `NG` 决定对象的总体结果

**配置来源**
- 模板摘要（含检验级别）、模板项、模板描述、模板单位、产线、工单均来源于只读配置接口

**可选开关**
- “新建表单后自动开始并弹新增对象明细”使用布尔开关控制（默认关闭）；需要 UI 开关时可用 `MudSwitch` 绑定该布尔值


