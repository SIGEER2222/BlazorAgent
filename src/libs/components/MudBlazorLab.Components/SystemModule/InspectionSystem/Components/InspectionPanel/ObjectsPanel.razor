@using global::InspectionSystem.Models
@using InspectionSystem.Services
@using HmiInspection.Models
@using MudBlazor
@namespace MudBlazorLab.Components.Components.InspectionPanel

<style>
    .mud-overlay {
        z-index: 6500 !important
    }

    .mud-dialog {
        z-index: 6600 !important
    }

    .mud-dialog-container {
        z-index: 6600 !important
    }
</style>

<MudOverlay @bind-Visible="@Visible" DarkBackground="true" Class="d-flex align-center justify-center"
            Style="position:fixed;inset:0;z-index:6400;">

    <MudPaper Elevation="24" Class="pa-4">
        <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="2">
            <MudText Typo="Typo.h6">对象：@(Form?.FormNo)</MudText>
            <MudText Typo="Typo.subtitle2">工单：@(Form?.WorkCenter)</MudText>
            <MudSpacer />
            <MudButton Variant="Variant.Filled" Color="Color.Primary" Disabled="@(AllowAddDetail)"
                       StartIcon="@Icons.Material.Filled.Add" OnClick="NewObject">新增对象</MudButton>
            <MudButton Variant="Variant.Outlined" Color="Color.Secondary" OnClick="Close">关闭</MudButton>
        </MudStack>
        <MudDataGrid @ref="InspectionObjectGrid" T="InspectionObjectView" Items="@_objectsView" Bordered="true"
                     Dense="true" Hover="true" Filterable="true" FixedHeader="true" Height="65vh" RowsPerPage="@_objPageSize"
                     RowClick="OnObjectRowClickView" SortMode="SortMode.Multiple">
            <Columns>
                <PropertyColumn T="InspectionObjectView" TProperty="string" Property="@(x => x.FormTemplateName)"
                                Title="表单模板" />
                <PropertyColumn T="InspectionObjectView" TProperty="string" Property="@(x => x.FormNo)" Title="表单单号" />
                <PropertyColumn T="InspectionObjectView" TProperty="string" Property="@(x => x.WorkCenter)" Title="工单单号" />
                <PropertyColumn T="InspectionObjectView" TProperty="string" Property="@(x => x.ProductName)"
                                Title="产线名称" />
                <PropertyColumn T="InspectionObjectView" TProperty="string" Property="@(x => x.ObjectType)"
                                Title="对象类型" />
                <PropertyColumn T="InspectionObjectView" TProperty="string" Property="@(x => x.ObjectDisplayName)"
                                Title="对象名称" />
                <PropertyColumn T="InspectionObjectView" TProperty="string" Property="@(x => x.CheckResult)"
                                Title="结果" />
                <PropertyColumn T="InspectionObjectView" TProperty="DateTime ?" Property="@(x => x.CreatedAt)"
                                Title="创建日期" />
                <PropertyColumn T="InspectionObjectView" TProperty="string" Property="@(x => x.CreateUser)"
                                Title="创建人" />
            </Columns>
            <PagerContent>
                <MudDataGridPager T="InspectionObjectView" PageSizeOptions="@_objPageOptions" />
            </PagerContent>
        </MudDataGrid>
    </MudPaper>
</MudOverlay>

<MudDialog @bind-Visible="_dlgObject">
    <DialogContent>
        <MudStack Spacing="2">
            <MudAutocomplete T="string" @bind-Value="_objectType" Label="对象类型" Placeholder="对象类型"
                             SearchFunc="SearchObjectTypes" CoerceText="true" CoerceValue="true" Clearable="true" Dense="true" />
            <MudTextField @bind-Value="_objectName" Label="对象名称" Placeholder="对象名称" Required="true" />
            <MudTextField @bind-Value="_objectCreator" Label="创建人" Placeholder="创建人" Required="true" />
            <MudDatePicker @bind-Date="_objectCreatedAt" Label="创建日期" />
        </MudStack>
    </DialogContent>
    <DialogActions>
        <MudButton Variant="Variant.Text" OnClick="@(() => _dlgObject = false)">取消</MudButton>
        <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="SaveObject">确定</MudButton>
    </DialogActions>
</MudDialog>

<DetailsPanel Visible="_openDetailsPanel" CurrentDoc="Form" CurrentObject="_currentObject"
              OnClose="CloseDetailsPanel" />
